name: Telegramæ¯æ—¥ç­¾åˆ°

# å®šæ—¶æ‰§è¡Œ & æ‰‹åŠ¨è§¦å‘
on:
  schedule:
    - cron: "23 17 * * *" # æ¯å¤© 23:17 UTCï¼ˆåŒ—äº¬æ—¶é—´ 07:17ï¼‰
  workflow_dispatch: # å¯æ‰‹åŠ¨è§¦å‘

jobs:
  telegram_sign:
    runs-on: ubuntu-latest
    env:
      TZ: Asia/Shanghai
      TELEGRAM_SESSION: ${{ secrets.TELEGRAM_SESSION }}
      TELEGRAM_API_ID: ${{ secrets.TELEGRAM_API_ID }}
      TELEGRAM_API_HASH: ${{ secrets.TELEGRAM_API_HASH }}
      TELEGRAM_SIGN_TASKS: ${{ secrets.TELEGRAM_SIGN_TASKS }}

    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v5
        with:
          fetch-depth: 1
          sparse-checkout: |
            telegram-sign

      - name: âœ… æ£€æŸ¥ç¯å¢ƒå˜é‡
        run: |
          for var in TELEGRAM_SESSION TELEGRAM_API_ID TELEGRAM_API_HASH TELEGRAM_SIGN_TASKS; do
            if [ -z "${!var}" ]; then
              echo "âŒ $var æœªè®¾ç½®æˆ–è€…ä¸ºç©º. è¯·åœ¨ GitHub Secrets ä¸­é…ç½®."
              exit 1
            fi
          done
          echo "âœ… æ‰€æœ‰ç¯å¢ƒå˜é‡å·²é…ç½®"

      - name: ğŸ è®¾ç½® Python ç¯å¢ƒ
        uses: actions/setup-python@v6
        with:
          python-version: "3.12"
          cache: "pip"

      - name: ğŸ å®‰è£…ä¾èµ–
        working-directory: telegram-sign
        run: pip install -r requirements.txt

      - name: è¿è¡ŒTelegramç­¾åˆ°ä»»åŠ¡
        working-directory: telegram-sign
        run: |
          echo "å®é™…å¼€å§‹è¿è¡Œæ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          python main.py
