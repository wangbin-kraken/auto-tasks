name: V2EXæ¯æ—¥ç­¾åˆ°

# å®šæ—¶æ‰§è¡Œ & æ‰‹åŠ¨è§¦å‘
on:
  schedule:
    - cron: "30 23 * * *" # æ¯å¤© 23:30 UTCï¼ˆåŒ—äº¬æ—¶é—´ 07:30ï¼‰
  workflow_dispatch: # å¯æ‰‹åŠ¨è§¦å‘

jobs:
  v2ex-sign:
    runs-on: ubuntu-latest
    env:
      TZ: Asia/Shanghai
      V2EX_COOKIE: ${{ secrets.V2EX_COOKIE }}
      TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
      TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}

    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v5
        with:
          fetch-depth: 1
          sparse-checkout: |
            v2ex-sign

      - name: âœ… æ£€æŸ¥ç¯å¢ƒå˜é‡
        run: |
          for var in V2EX_COOKIE TELEGRAM_BOT_TOKEN TELEGRAM_CHAT_ID; do
            if [ -z "${!var}" ]; then
              echo "âŒ $var æœªè®¾ç½®æˆ–è€…ä¸ºç©º. è¯·åœ¨ GitHub Secrets ä¸­é…ç½®."
              exit 1
            fi
          done
          echo "âœ… æ‰€æœ‰ç¯å¢ƒå˜é‡å·²é…ç½®"

      - name: ğŸ è®¾ç½® Python ç¯å¢ƒ
        uses: actions/setup-python@v6
        with:
          python-version: "3.14"
          cache: "pip"

      - name: ğŸ å®‰è£…ä¾èµ–
        working-directory: v2ex-sign
        run: pip install -r requirements.txt

      - name: è¿è¡ŒV2EXç­¾åˆ°ä»»åŠ¡
        working-directory: v2ex-sign
        run: |
          echo "å®é™…å¼€å§‹è¿è¡Œæ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          python3 main.py
